# 物料版本方案

## 发布版本约定

根据[版本规范](./material-version.html)落地物料各个阶段版本号规定：

- 主版本号(major)：当你做了不兼容的 API 修改（产品功能做了大的不兼容调整/重构）
- 次版本号(minor)：当你做了向下兼容的功能性新增（产品增加了兼容以前的小功能）
- 修订号(patch)：当你做了向下兼容的问题修正（对某个功能的 bug 修复）

### 初始化组件

初始版本：0.1.0

| 开发阶段 | 代码分支        | 版本号         | 发布时机 | 发布版本号     | 执行命令                              |
| -------- | --------------- | -------------- | -------- | -------------- | ------------------------------------- |
| 开发阶段 | feat_xx_develop | `0.1.0`        | 开发阶段 | `1.0.0-beta-*` | `winex publish  --beta major` |
| rc 阶段  | rc              | `1.0.0-beta-*` | 测试通过 | `1.0.0`        | `winex publish --release major`                 |

### 组件迭代

#### bug 修复

| 开发阶段 | 代码分支        | 版本号           | 发布时机 | 发布版本号       | 执行命令                              |
| -------- | --------------- | ---------------- | -------- | ---------------- | ------------------------------------- |
| 开发阶段 | feat_xx_develop | `x-y-z`          | 开发阶段 | `x-y-z+1-beta-*` | `winex publish --beta patch` |
| rc 阶段  | rc              | `x-y-z+1-beta-*` | 测试通过 | `x-y-z+1`        | `winex publish --release patch`                 |

#### 新增向下兼容的功能

| 开发阶段 | 代码分支        | 版本号           | 发布时机 | 发布版本号       | 执行命令                              |
| -------- | --------------- | ---------------- | -------- | ---------------- | ------------------------------------- |
| 开发阶段 | feat_xx_develop | `x-y-z`          | 开发阶段 | `x-y+1-0-beta-*` | `winex publish --beta minor` |
| rc 阶段  | rc              | `x-y+1-0-beta-*` | 测试通过 | `x-y+1-0`        | `winex publish --release minor`                 |

#### 重构或者做了不向下兼容的功能

| 开发阶段 | 代码分支        | 版本号           | 发布时机 | 发布版本号       | 执行命令                              |
| -------- | --------------- | ---------------- | -------- | ---------------- | ------------------------------------- |
| 开发阶段 | feat_xx_develop | `x-y-z`          | 开发阶段 | `x+1-0-0-beta-*` | `winex publish --beta major` |
| rc 阶段  | rc              | `x+1-0-0-beta-*` | 测试通过 | `x+1-0-0`        | `winex publish --release major`                 |

## 使用组件版本

我们约定在项目中 rc(包括 rc)之后均使用 **release 正式版本**，不能使用带有`-beta`标识符版本，项目依赖版本格式：

 - [x] 正式版本标识符我们采用: `~x.y.z`格式，保证 patch 修复更新自动更新
 - [x] 正式版本标识符我们采用：`x.y.z`格式，使用绝对版本
 - [ ] 正式版本标识符我们采用：`^x.y.z`格式，较粗的版本控制，只控制major，会自动升级minor和patch (不建议，因为会自动升级小版本)


### 锁定依赖版本

lock文件

实际开发中，经常会因为各种依赖不一致而产生奇怪的问题，或者在某些场景下，我们不希望依赖被更新，建议在开发中使用 `[package | yarn]-lock.json`。

锁定依赖版本意味着在我们不手动执行更新的情况下，每次安装依赖都会安装固定版本。保证整个团队使用版本号一致的依赖。

每次安装固定版本，无需计算依赖版本范围，大部分场景下能大大加速依赖安装时间。

::: warning
使用 package-lock.json 要确保npm的版本在5.6以上，因为在5.0 - 5.6中间，对 package-lock.json的处理逻辑进行过几次更新，5.6版本后处理逻辑逐渐稳定。
:::

### 更新依赖

实际开发场景下，我们虽然不需要每次都去安装新的版本，仍然需要定时去升级依赖版本，来让我们享受依赖包升级带来的问题修复、性能提升、新特性更新。

<img :src="$withBase('/outdated.png')" alt="npm outdated">

使用 `npm outdated` 可以帮助我们列出有哪些还没有升级到最新版本的依赖：

- 黄色表示不符合我们指定的语意化版本范围 - 不需要升级
- 红色表示符合指定的语意化版本范围 - 需要升级


执行 `npm update` 会升级所有的红色依赖。
