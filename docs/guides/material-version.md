# 版本规范


## 版本格式
物料的版本都需要遵循 SemVer规范——由 Github 起草的一个具有指导意义的，统一的版本号表示规则。实际上就是 [Semantic Version（语义化版本）](https://semver.org/lang/zh-CN/)的缩写。

### 标准版本(release)

标准版本号采用 X.Y.Z 的格式，其中 X、Y 和 Z 为非负的整数，且禁止在数字前方补零。X 是主版本号、Y 是次版本号、而 Z 为修订号。每个元素必须以数值来递增。版本号递增规则如下：

- 主版本号(major)：当你做了不兼容的 API 修改（产品功能做了大的不兼容调整/重构）
- 次版本号(minor)：当你做了向下兼容的功能性新增（产品增加了兼容以前的小功能）
- 修订号(patch)：当你做了向下兼容的问题修正（对某个功能的bug修复）

> 例如：1.9.1 -> 1.10.0 -> 1.11.0


### 公测版本(beta)

当某个版本新增了业务功能，目前已经开发完毕，但是还未通过测试，功能还并非稳定而且可能无法满足预期的兼容性需求时，你可能要先发布一个公测版本，也称之为beta版本（下文提及beta版本均指公测版本）。

beta版本号及版本编译信息可以加到“主版本号.次版本号.修订号”的后面作为延伸，先加上一个连接号再加上一连串以句点分隔的标识符和版本编译信息，一般大家认同的标识符如下：

- ~~内部版本(alpha)~~
- **公测版本(beta)**
- ~~正式版本的候选版本rc: 即 Release candiate~~

我们为了操作方便，只使用beta公测标识符，当然开发过程中你作为开发想要把版本区分的更加精细，也可以按照如上标识符发布对应的版本号

::: warning
作为一位负责任的开发者，你理当确保每次包升级的运作与版本号的表述一致。现实世界是复杂的，我们除了提高警觉外能做的不多。你所能做的就是让语义化的版本控制为你提供一个健全的方式来发行以及升级包，而无需推出新的依赖包，节省你的时间及烦恼。
:::

::: warning
作为一位负责任的使用者，你理当理解每个版本的含义，根据项目所处的不同阶段使用相对应的版本，比如不要在rc/生产环境使用beta等其他非release版本号
:::


## 依赖版本管理

yarn: 1.19.0

我们经常看到，在 package.json 中各种依赖的不同写法：
```javascript
"dependencies": {
    "signale": "1.4.0",
    "figlet": "*",
    "vue": "2.x",
    "table": "~5.4.6",
    "yargs": "^14.0.0"
}
```

前面三个很容易理解：

- "signale": "1.4.0": 固定版本号
- "figlet": "*": 任意版本（>= 0.0.0）
- "vue": "2.x": 匹配主要版本（>= 2.0.0 < 3.0.0）
- "vue": "2.3.x": 匹配主要版本和次要版本（>= 2.3.0 < 2.4.0）

再来看看后面两个，版本号中引用了 ~ 和 ^ 符号：

#### patch版本升级

| lock文件   | 包工具   | node_modules |  格式  | 安装前   | 安装后  | 安装命令 | 最新版本
| --------- | --------   | --------------- | --------   | -----  | -----   | ------ | ------ |
| 有        | yarn |      否         | `^9.1.0`  | `9.1.2` | `9.1.2` | `yarn` | `9.1.4` 
| 有        | yarn |      是         | `^9.1.0`  | `9.0.2` | `9.0.2` | `yarn` | `9.1.4`
| 否        | yarn |      否         | `^9.1.0`  | `9.1.2` | `9.1.4` | `yarn` | `9.1.4`
| 否        | yarn |      是         | `^9.1.0`  | `9.1.2` | `9.1.4` | `yarn` | `9.1.4`
| 有        | yarn |      否         | `~9.1.0`  | `9.1.6` | `9.1.6` | `yarn` | `9.1.8` 
| 有        | yarn |      是         | `~9.1.0`  | `9.1.6` | `9.1.6` | `yarn` | `9.1.8`
| 否        | yarn |      否         | `~9.1.0`  | `9.1.8` | `9.1.10` | `yarn` | `9.1.10`
| 否        | yarn |      是         | `~9.1.0`  | `9.1.6` | `9.1.8` | `yarn` | `9.1.8`

:::tip
**~: 当安装依赖时获取到有新版本时，安装到 x.y.z 中 z 的最新的版本。即保持主版本号、次版本号不变的情况下，保持修订号的最新版本。**
:::

#### minor版本升级


| lock文件   | 包工具   | node_modules |  格式  | 安装前   | 安装后  | 安装命令 | 最新版本
| --------- | --------   | --------------- | --------   | -----  | -----   | ------ | ------ |
| 有        | yarn |      否         | `^9.0.0`  | `9.0.0` | `9.0.0` | `yarn` | `9.1.0` 
| 有        | yarn |      是         | `^9.0.0`  | `9.0.0` | `9.0.0` | `yarn` | `9.1.0`
| 否        | yarn |      否         | `^9.0.0`  | `9.0.0` | `9.1.0` | `yarn` | `9.1.0`
| 否        | yarn |      是         | `^9.0.0`  | `9.0.0` | `9.1.0` | `yarn` | `9.1.0`
| 有        | yarn |      否         | `~9.0.0`  | `9.0.0` | `9.0.0` | `yarn` | `9.1.0` 
| 有        | yarn |      是         | `~9.0.0`  | `9.0.0` | `9.0.0` | `yarn` | `9.1.0`
| 否        | yarn |      否         | `~9.0.0`  | `9.0.0` | `9.0.0` | `yarn` | `9.1.0`
| 否        | yarn |      是         | `~9.0.0`  | `9.0.0` | `9.0.0` | `yarn` | `9.1.0`

:::tip
**^: 当安装依赖时获取到有新版本时，安装到 x.y.z 中 y 和 z 都为最新版本。 即保持主版本号不变的情况下，保持次版本号、修订版本号为最新版本。**
:::

在 package.json 文件中最常见的应该是 `"yargs": "^14.0.0"`这种格式的依赖, 因为我们在使用 npm install package 安装包时，npm 默认安装当前最新版本，然后在所安装的版本号前加 ^ 号。

注意，当主版本号为 0 的情况，会被认为是一个不稳定版本，情况与上面不同：

- 主版本号和次版本号都为 0: `^0.0.z、~0.0.z` 都被当作固定版本，安装依赖时均不会发生变化。
- 主版本号为 0: ^0.y.z 表现和 ~0.y.z 相同，只保持修订号为最新版本。
- 1.0.0 的版本号用于界定公共 API。当你的软件发布到了正式环境，或者有稳定的API时，就可以发布1.0.0版本了。所以，当你决定对外部发布一个正式版本的npm包时，把它的版本标为1.0.0。





